<ПравилаОбмена>
	<ВерсияФормата РежимСовместимости="">2.01</ВерсияФормата>
	<Ид>3436b171-bd99-4fe2-96db-81fd27f27bd8    </Ид>
	<Наименование>(проекты) ERP УСО (2.5.6) --&gt; УПП (ГК трио)</Наименование>
	<ДатаВремяСоздания>2021-09-23T13:24:13</ДатаВремяСоздания>
	<Источник ВерсияПлатформы="8.0" ВерсияКонфигурации="2.5.6.220" СинонимКонфигурации="1С:ERP Управление строительной организацией 2, редакция 2.5">ERPУправлениеСтроительнойОрганизацией</Источник>
	<Приемник ВерсияПлатформы="8.0" ВерсияКонфигурации="1.3.109.1" СинонимКонфигурации="Управление производственным предприятием, редакция 1.3">УПП (ГК трио)</Приемник>
	<ПередЗагрузкойДанных>Параметры.Вставить("Группа_ПСЭ",Справочники.Проекты.НайтиПоКоду("Ц00000485"));
Сообщить("Установка параметра (Группа_ПСЭ:спр.проекты): "+Параметры.Группа_ПСЭ);
Отказ = не ЗначениеЗаполнено(Параметры.Группа_ПСЭ);
Если Отказ Тогда
	Сообщить("Установка параметра (Группа_ПСЭ:спр.проекты): (не установлен) - загрузка отменена.",СтатусСообщения.ОченьВажное);	
КонецЕсли;</ПередЗагрузкойДанных>
	<Параметры/>
	<Обработки/>
	<ПравилаКонвертацииОбъектов>
		<Группа>
			<Код>Справочники</Код>
			<Наименование>Справочники</Наименование>
			<Порядок>50</Порядок>
			<Правило>
				<Код>ПроектыГруппа</Код>
				<Наименование>: </Наименование>
				<Порядок>50</Порядок>
				<НеЗамещать>true</НеЗамещать>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<Источник>СправочникСсылка.Проекты</Источник>
				<Приемник>СправочникСсылка.Проекты</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true" Обязательное="true">
						<Код>2</Код>
						<Наименование>--&gt; ЭтоГруппа</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Проекты</Код>
				<Наименование>Справочник: Проекты</Наименование>
				<Порядок>100</Порядок>
				<ПослеЗагрузки>Отказ = не (Объект.Родитель = Параметры.Группа_ПСЭ или Объект.Родитель.Родитель = Параметры.Группа_ПСЭ) 
		или не ЗначениеЗаполнено(Параметры.Группа_ПСЭ);
Если отказ Тогда
	Сообщить("Проект не принадлежит ПСЭ: "+Объект);
КонецЕсли;
</ПослеЗагрузки>
				<Источник>СправочникСсылка.Проекты</Источник>
				<Приемник>СправочникСсылка.Проекты</Приемник>
				<Свойства>
					<Свойство>
						<Код>1</Код>
						<Наименование>ДатаНачала --&gt; ДатаНачала</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="ДатаНачала" Вид="Реквизит" Тип="Дата"/>
						<Приемник Имя="ДатаНачала" Вид="Реквизит" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>ДатаОкончания --&gt; ДатаОкончания</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="ДатаОкончания" Вид="Реквизит" Тип="Дата"/>
						<Приемник Имя="ДатаОкончания" Вид="Реквизит" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>4</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>5</Код>
						<Наименование>Родитель --&gt; Родитель</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.Проекты"/>
						<Приемник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.Проекты"/>
						<КодПравилаКонвертации>Проекты                                           </КодПравилаКонвертации>
						<ПередВыгрузкой>Если ЗначениеЗаполнено(Источник.Ссылка.Родитель) Тогда
	ИмяПКО = "Проекты";
Иначе
	ИмяПКО = "ПроектыГруппа";
	ИсходящиеДанные = Новый Структура("Код, ЭтоГруппа");
	ИсходящиеДанные.Код       = "Ц00000485";
	ИсходящиеДанные.ЭтоГруппа = Истина;	
	Значение =	ИсходящиеДанные; 
КонецЕсли;

	</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>Комментарий --&gt; Описание</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="Описание" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true" Обязательное="true">
						<Код>7</Код>
						<Наименование>--&gt; ЭтоГруппа</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
						<ПередВыгрузкой>Если Источник.Ссылка.Уровень() = 0 Тогда
	Значение = Истина;
Иначе
	Значение = Ложь;
КонецЕсли;</ПередВыгрузкой>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
		</Группа>
	</ПравилаКонвертацииОбъектов>
	<ПравилаВыгрузкиДанных>
		<Группа Отключить="false">
			<Код>Справочники</Код>
			<Наименование>Справочники</Наименование>
			<Порядок>50</Порядок>
			<Правило Отключить="false">
				<Код>Проекты</Код>
				<Наименование>Проекты</Наименование>
				<Порядок>50</Порядок>
				<КодПравилаКонвертации>Проекты                                           </КодПравилаКонвертации>
				<СпособОтбораДанных>ПроизвольныйАлгоритм</СпособОтбораДанных>
				<ОбъектВыборки>СправочникСсылка.Проекты</ОбъектВыборки>
				<ПередОбработкойПравила>Результат =  Запросы.ВыборкаПроектов.Выполнить().Выбрать();
Сообщить("1 ВыборкаДанных.Количество():"+Результат.Количество());
Пока Результат.Следующий() Цикл
	ВыгрузитьПоПравилу(Результат.Ссылка, , , , "Проекты");	
КонецЦикла;
</ПередОбработкойПравила>
			</Правило>
		</Группа>
	</ПравилаВыгрузкиДанных>
	<ПравилаОчисткиДанных/>
	<Алгоритмы/>
	<Запросы>
		<Запрос Имя="ВыборкаПроектов" ИспользуетсяПриЗагрузке="false">
			<Текст>ВЫБРАТЬ
	Проекты.Ссылка КАК Ссылка
ПОМЕСТИТЬ ВТ_ТаблицыПервогоУровня
ИЗ
	Справочник.Проекты КАК Проекты
ГДЕ
	Проекты.Родитель = ЗНАЧЕНИЕ(Справочник.проекты.ПустаяСсылка)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Проекты.Ссылка КАК Ссылка,
	Проекты.Родитель КАК Родитель,
	Проекты.Код КАК Код,
	Проекты.Наименование КАК Наименование,
	Проекты.ДатаНачала КАК ДатаНачала,
	Проекты.ДатаОкончания КАК ДатаОкончания,
	Проекты.Комментарий КАК Комментарий
ИЗ
	ВТ_ТаблицыПервогоУровня КАК ВТ_ТаблицыПервогоУровня
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Проекты КАК Проекты
		ПО (ВТ_ТаблицыПервогоУровня.Ссылка = Проекты.Родитель)
ГДЕ
	Проекты.Наименование &lt;&gt; ""</Текст>
		</Запрос>
	</Запросы>
</ПравилаОбмена>